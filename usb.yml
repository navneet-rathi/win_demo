---
- name: Disable USB storage and enable one USB port on Windows 7
  hosts: all
  tasks:
    
    # Task 1: Disable USB storage via Registry
    - name: Disable USB storage by modifying registry
      ansible.windows.win_regedit:
        path: 'HKLM\SYSTEM\CurrentControlSet\Services\USBSTOR'
        name: 'Start'
        data: 4
        type: dword
      #become: yes
    
    # Task 2: Get all USB Root Hubs in Device Manager
    - name: Get all USB Root Hub devices
      ansible.windows.win_shell: |
        Get-PnpDevice -FriendlyName "USB Root Hub" | Select-Object FriendlyName, DeviceID
      register: usb_root_hubs
